name: pwmetrics-performance-test

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  performance:
    runs-on: ubuntu-latest

    container:
      image: mcr.microsoft.com/playwright:v1.44.1-focal # or another image with Chrome + Node
      options: --shm-size=2gb

    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v3

      - name: ðŸ“¦ Install pwmetrics
        run: npm install -g pwmetrics

      - name: ðŸš€ Run pwmetrics on playwright.com
        run: |
          pwmetrics https://playwright.com \
            --json \
            --chrome-flags="--headless=new --no-sandbox --disable-gpu --remote-debugging-port=9222" \
            > performance-results.json

      - name: ðŸ“¤ Upload pwmetrics result
        uses: actions/upload-artifact@v4
        with:
          name: pwmetrics-results
          path: performance-results.json
